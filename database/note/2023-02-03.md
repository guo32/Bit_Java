# ğŸ‘¾ MongoDB

1. **ê³µìœ  í´ë” : í¸ì§‘ì (íŒŒì¼ ì—…ë¡œë“œ)**
    1. ì‹œí—˜ ë‹µì•ˆ ì œì¶œ
    2. ë¯¸ë‹ˆ í”„ë¡œì íŠ¸ ê²°ê³¼ë¬¼ ì œì¶œ
    3. ì œì¶œ ë°©ì‹ì€ ì§€ì •í•œ ëŒ€ë¡œ ê³µìœ  í´ë”ì— ì—…ë¡œë“œ (ì´ë©”ì¼ X)
2. **2ì›” 8ì¼ ì˜¤í›„ ëª½ê³ ë””ë¹„ í‰ê°€ (16ì‹œ 30ë¶„)**
3. **ë¯¸ë‹ˆ í”„ë¡œì íŠ¸ (ê°œì¸)** 
    1. ê¸ˆìš”ì¼ (2/10 ì˜¤ì „ 9ì‹œ ê¹Œì§€)
    2. ì œì¶œë¬¼ (2/6 ê³µì§€)
        1. í”„ë¡œì íŠ¸ì˜ ëª©í‘œ ë° ê¸°ëŠ¥
        2. ë°ì´í„° ì†ŒìŠ¤ URL(web, api, file ë“±)
            1. web: URL
            2. api: ìë£Œ ì œê³µì²˜ ë° API URI
            3. íŒŒì¼: ìë£Œ ì œê³µì²˜ ë° ì›ë³¸ íŒŒì¼
        3. ì£¼ìš” ì¡°íšŒ ì¿¼ë¦¬
            1. find() ë¬¸
            2. ê´€ë ¨ ì¸ë±ìŠ¤(text ì¸ë±ìŠ¤ í¬í•¨ 2ì¢…) ìƒì„±í•˜ê¸° ì „ê³¼ í›„ì˜ ì‹¤í–‰ê³„íš ë¹„êµ
                1. winning plan ë¶€ë¶„ ì´ë¯¸ì§€ ìº¡ì²˜
                2. index1_before.jpg, index1_after.jpg, index2_before.jpg, index2_after.jpg
        4. ëª½ê³ ë””ë¹„ ë°ì´í„°ë² ì´ìŠ¤ì— ê´€ë ¨ëœ ê°ì²´ ì´ë¦„ ë° ìƒì„± ëª…ë ¹ì–´ë“¤ ëª©ë¡
            1. ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„, ì»¬ë ‰ì…˜ ì´ë¦„ ë“±ì´ í¬í•¨ë˜ì–´ì•¼ í•¨
            2. ì¸ë±ìŠ¤ ìƒì„± ëª…ë ¹ì–´, find() ëª…ë ¹ì–´ ì‚¬ìš© ëª©ë¡
            3. ì™¸ë¶€ ë°ì´í„° ì„±ê²©ì— ëŒ€í•œ ê¸°ìˆ  ëª©ë¡
        5. íŒŒì´ì¬ê³¼ ì—°ë™í•œ ê²½ìš°, ì†ŒìŠ¤ì½”ë“œ (*.py ë˜ëŠ” *.ipynb)
        6. ì œì¶œ íŒŒì¼(2ì›” 10ì¼ ì˜¤ì „ 9ì‹œê¹Œì§€)
            1. ê³µìœ  í´ë”ì— ìì‹ ì˜ â€œí•œê¸€ì´ë¦„/í”„ë¡œì íŠ¸â€ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ í´ë” ìƒì„± í›„
                1. 1, 2, 4 í•­ì˜ ê¸°ìˆ  ë¶€ë¶„ì€ *.txt
                2. 3í•­ì˜ ì´ë¯¸ì§€ íŒŒì¼ë“¤ì€ 4ê°œì˜ jpg
                3. 2í•­(ì„ íƒì ), 5í•­ì—ì„œ ë°œìƒí•˜ëŠ” íŒŒì¼ë“¤ì€ ê°ê° í˜•ì‹ì— ë§ì¶°ì„œ
                4. 6ê°œì˜ íŒŒì¼ ì´ìƒì´ ë  ê²ƒì„
4. **ìˆ˜ì—… ì‹œê°„ì— ë‹¤ë£¨ëŠ” ë‚´ìš©**
    1. ê¸°íƒ€ ì‰˜ì—ì„œ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´ë“¤
    2. CRUD
    3. ì¸ë±ì‹± (ì‹±ê¸€, ë³µí•©, í…ìŠ¤íŠ¸, ìœ„ì¹˜ê¸°ë°˜ ì¸ë±ìŠ¤)
    4. íŒŒì´ì¬ìœ¼ë¡œ ëª½ê³ ë””ë¹„ë‘ ì—°ë™
    5. ì›¹ì—ì„œ ë°ì´í„°ë¥¼ í¬ë¡¤ë§í•´ì„œ ì²˜ë¦¬í•˜ê³  ì €ì¥í•œ ë‹¤ìŒ CRUD
    6. ìë£Œí˜• (list, dictionary)
    7. ë°˜ë³µë¬¸ ì—°ìŠµ

## âœ” ì¸ë±ì‹± ê·œì¹™

- í•œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ì„œ í•˜ë‚˜ì˜ ì¸ë±ìŠ¤ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
- ë³µí•© í‚¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ì— ëŒ€í•´ì„œëŠ” ë³µí•© ì¸ë±ìŠ¤ê°€ ì í•©í•¨
- ë³µí•© ì¸ë±ìŠ¤ì—ì„œ í‚¤ì˜ ìˆœì„œê°€ ì¤‘ìš”í•¨

## âœ” ë³µí•© ì¸ë±ìŠ¤ (Compound Index)

- ì¸ë±ìŠ¤ëŠ” ëª¨ë“  ê°’ì„ ì •ë ¬ëœ ìˆœì„œë¡œ ë³´ê´€
- ì¸ë±ìŠ¤ í‚¤ë¡œ ë„íë¨¼íŠ¸ë¥¼ ì •ë ¬í•˜ëŠ” ì‘ì—…ì´ ìš©ì´
- **ë³µí•© ì¸ë±ìŠ¤ ìƒì„± ì‹œ í•„ë“œ(í‚¤) ìˆœì„œ**
    - age : 1, username : 1
    
    ```sql
    bitDB> db.users.createIndex({age:1, username:1})
    age_1_username_1
    bitDB> db.users.find().sort({age:1, username:1}).explain("executionStats").executionStats.executionTimeMillis
    2613
    bitDB> db.users.find().sort({username:1, age:1}).explain("executionStats").executionStats.executionTimeMillis
    8937
    ```
    
    - username : 1, age : 1
    
    ```sql
    bitDB> db.users.createIndex({username:1, age:1})
    username_1_age_1
    bitDB> db.users.find().sort({age:1, username:1}).explain("executionStats").executionStats.executionTimeMillis
    2461
    bitDB> db.users.find().sort({username:1, age:1}).explain("executionStats").executionStats.executionTimeMillis
    3309 --> í›¨ì”¬ ë¹ ë¦„
    ```
    

## âœ” í…ìŠ¤íŠ¸ ì¸ë±ìŠ¤ (Text Index)

- ì œëª©, ì„¤ëª… ë“± ì»¬ë ‰ì…˜ ë‚´ì— ìˆëŠ” í•„ë“œì˜ í…ìŠ¤íŠ¸ì™€ ì¼ì¹˜ì‹œí‚¤ëŠ” í‚¤ì›Œë“œ ê²€ìƒ‰ì— ì‚¬ìš©
- **ì •ê·œ í‘œí˜„ì‹** ì‚¬ìš©í•˜ê¸°

```sql
bitDB> db.stores.find({name:{$regex:"Sh.*"}})
[
  { _id: 3, name: 'Coffee Shop', description: 'Just coffee' },
  { _id: 5, name: 'Java Shopping', description: 'Indonesian goods' }
]
```

- **í…ìŠ¤íŠ¸ ì¸ë±ìŠ¤** ì‚¬ìš©í•˜ê¸°

```sql
bitDB> db.stores.createIndex({name:"text"})
name_text

// java or coffee or shop í¬í•¨
bitDB> db.stores.find({$text:{$search:'java coffee shop'}})
[
  { _id: 3, name: 'Coffee Shop', description: 'Just coffee' },
  { _id: 5, name: 'Java Shopping', description: 'Indonesian goods' },
  { _id: 1, name: 'Java Hut', description: 'Coffee and cakes' }
]

// "java shop" í¬í•¨
bitDB> db.stores.find({$text:{$search:'\"java shop\"'}})
[ { _id: 5, name: 'Java Shopping', description: 'Indonesian goods' } ]

// ëŒ€ì†Œë¬¸ì êµ¬ë¶„í•´ì„œ ê²€ìƒ‰
bitDB> db.stores.find({$text:{$search:'Coffee', $caseSensitive: true}})
[ { _id: 3, name: 'Coffee Shop', description: 'Just coffee' } ]
```

## âœ” GeoJSON ê°ì²´

- ê³µê°„ ì •ë³´ ì¿¼ë¦¬ì˜ ìœ í˜• : êµì°¨(intersect), í¬í•¨(within), ê·¼ì ‘(nearness)

## âœ” ê³µê°„ ì •ë³´ ì¿¼ë¦¬

- ê³µê°„ ì •ë³´ ì¿¼ë¦¬ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‹¤í–‰
- ì˜ˆì œ 1

```sql
db.places.find({
	location:{
		$geoIntersects:{
			$geometry:{
				type:"Polygon",
				coordinates:[
					[[126.86, 33.39], [126.88, 33.39], [126.88, 33.37], [126.86, 33.37], [126.86, 33.39]]
				]
			}
		}
	}
})

// ì‹ ì‚°ë¦¬ ë§ˆì„íšŒê´€ 5km ë‚´ì— ìˆëŠ” ì¥ì†Œ ì°¾ê¸°
db.legacyplaces.find({
	location:{
		$geoWithin:{
			$centerSphere:[[126.876933, 33.381018], 5/6378.1]
		}
	}
})
```

## âœ” ì—°ìŠµë¬¸ì œ

- ì»¬ë ‰ì…˜ ë ˆìŠ¤í† ë‘ì˜ ëª¨ë“  ë¬¸ì„œì— ëŒ€í•œ restaurant_id, name, borough ë° cuisine í•„ë“œ í‘œê¸°

```sql
db.restaurants.find({}, {restaurant_id:1, name:1, borough:1, cuisine:1})
```

- ì´ì „ ë¬¸ì œì—ì„œ _id í•„ë“œ ì œì™¸

```sql
db.restaurants.find({}, {restaurant_id:1, name:1, borough:1, cuisine:1, _id:0})
```

- â€˜Bronxâ€™ ì§€ì—­ì— ìˆëŠ” ëª¨ë“  ë ˆìŠ¤í† ë‘ ì •ë³´ ì¶œë ¥

```sql
db.restaurants.find({borough: "Bronx"})
```

- â€˜Bronxâ€™ ì§€ì—­ì— ìˆëŠ” ë ˆìŠ¤í† ë‘ ì¤‘ ì²˜ìŒ ë‹¤ì„¯ ê°œ ì •ë³´ ì¶œë ¥

```sql
db.restaurants.find({borough: "Bronx"}).limit(5)
```

- â€˜Bronxâ€™ ì§€ì—­ì— ìˆëŠ” ë ˆìŠ¤í† ë‘ ì¤‘ ì²˜ìŒ ë‹¤ì„¯ ê°œë¥¼ ê±´ë„ˆ ë›´ ë‹¤ìŒ 5ê°œ ì •ë³´ ì¶œë ¥

```sql
db.restaurants.find({borough: "Bronx"}).skip(5).limit(5)
```

- ì ìˆ˜ê°€ 90ì  ì´ìƒì¸ ë ˆìŠ¤í† ë‘ ì¶œë ¥

```sql
db.restaurants.find({"grades.score":{$gte:90}})
```

- ì ìˆ˜ê°€ 80ì  ì´ìƒ 100ì  ë¯¸ë§Œì¸ ë ˆìŠ¤í† ë‘ ì¶œë ¥

```sql
db.restaurants.find({"grades":{$elemMatch: {score: {$gte: 80, $lt: 100}}}})
```

- ìœ„ë„ê°€ -95.754168ë³´ë‹¤ ë‚®ì€ ìœ„ì¹˜ì— ìˆëŠ” ë ˆìŠ¤í† ë‘ ì¶œë ¥

```sql
db.restaurants.find({"address.coord.0" : {$lt: -95.754168}})
```

- â€˜Americanâ€™ ìš”ë¦¬ê°€ ì¤€ë¹„ë˜ì§€ ì•Šê³  ì ìˆ˜ê°€ 70ì  ì´ìƒì´ë©´ì„œ ìœ„ë„ê°€ -65.754168ë³´ë‹¤ ë‚®ì€ ìœ„ì¹˜ì— ìˆëŠ” ë ˆìŠ¤í† ë‘ ì¶œë ¥

```sql
db.restaurants.find({cuisine:{$ne:"American"}, "grades.score":{$gte:70}, "address.coord.0": {$lt:-65.754168}}, {name: 1, _id: 0})
```

- â€˜Americanâ€™ ìš”ë¦¬ê°€ ì¤€ë¹„ë˜ì§€ ì•Šìœ¼ë©´ì„œ â€˜gradeâ€™ê°€ â€˜Aâ€™ì´ë©´ì„œ â€˜Brooklynâ€™ ì§€ì—­ì— ìœ„ì¹˜í•˜ì§€ ì•ŠëŠ” ë ˆìŠ¤í† ë‘ documentë“¤ì„ â€˜cuisineâ€™ í•„ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬

```sql
db.restaurants.find({cuisine:{$ne:"American"}, "grades.grade":{$eq:"A"}, borough:{$ne:"Brooklyn"}}).sort({cuisine:-1})
```

- ì´ë¦„ì˜ ë§ˆì§€ë§‰ ì„¸ê¸€ìì— â€˜cesâ€™ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” ë ˆìŠ¤í† ë‘ documentë“¤ì˜ restaurant_id, name, borough and cuisine í•„ë“œ ì¶œë ¥

```sql
db.restaurants.find({name: {$regex: "ces$"}}, {restaurant_id:1, name:1, borough:1, cuisine:1})
```

- ì´ë¦„ì— â€˜Regâ€™ë¼ëŠ” ë¬¸ìì—´ì„ í¬í•¨í•˜ê³  ìˆëŠ” ë ˆìŠ¤í† ë‘ ì¶œë ¥

```sql
db.restaurants.find({name: {$regex: ".*Reg"}})
```

- ë‚ ì§œ ì¡°íšŒí•˜ëŠ” ì˜ˆë¥¼ ì°¸ì¡°í•˜ì—¬ ISODate â€œ2014-08-11T00:00:00Zâ€ì— â€˜gradeâ€™ê°€ â€˜Aâ€™, â€˜scoreâ€™ê°€ 11ì¸ ë ˆìŠ¤í† ë‘ ì¶œë ¥

```sql
db.restaurants.find({"grades.date": ISODate("2014-08-11T00:00:00Z"), "grades.grade":"A", "grades.score":11})
```

- â€˜gradesâ€™ í•„ë“œì˜ ë‘ ë²ˆì§¸ ìš”ì†Œê°€ ISODate â€œ2014-08-11T00:00:00Zâ€ì— â€˜Aâ€™, 9ì ì¸ ë ˆìŠ¤í† ë‘ ì¶œë ¥

```sql
db.restaurants.find({grades:{date:ISODate("2014-08-11T00:00:00Z"), grade: "A", score: 9}})
```

- addressì— street í•„ë“œê°€ ìˆëŠ” ë ˆìŠ¤í† ë‘ë“¤ë§Œ ì¶œë ¥

```sql
db.restaurants.find({"address.street":  {$ne:null}})
```
